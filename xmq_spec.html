<!DOCTYPE html>
<html>
<header>
<link type="text/css" href="xmq_spec.css" rel="stylesheet"/>
<body>

    <h1>XMQ specification</h1>

    As of 2021-01-18 and in flux. By Fredrik Öhrström oehrstroem@gmail.com

    <p>
    XMQ can represent a tree of tagged content and each tag can have attributes.
    The XMQ functions can be bound to your XML-parser/generator of choice and
    therefore be converted back and forth from/to XML. If your parser/generator is
    able to parse/generate html5/sgml, then you can convert back and forth with
    these as well. However there is no guarantee that there is an exact mapping back.
    </p>

    <p>
    If you do not need to work with XML, then you can also use XMQ directly
    without binding to a XML-parser/generator. If you later need full XML-support,
    for schema validation etc, then you can simply bind at a later time.
    </p>

    <p>
    <b>text</b> consists of all valid utf8 exluding
    these 6 reserved characters <b>= ' ( ) { }</b>
    as well as whitespace (SPACE,TAB,LF,CR) and the <b>nul</b> character.
    (Examples of text are: 123.4 \P$ http://www.zzz.yyy/index.html /file/help.txt C:\adir)
    </p>

    <p>
    <b>tag</b> is <b>text</b> but with the additional xml tag name restrictions.
    (Examples of tags are: name age speed INFO order)
    </p>

    <p>
    <b>quoted content</b> starts with one, three or more single quotes <b>'</b> and ends with an equal
     amount of singel quotes. Use n+1 quotes to quote an utf8 string containing at most n consecutive quotes.
     Two single quotes are always the empty string.
     (Examples of quoted contents are: '' 'John Doe' '5+(8*9)' '''(&gt;'&lt;)''' )
    </p>

    <p>
     <b>tag</b> is a self-closing node <b>&lt;tag/&gt;</b>
    </p>

    <p>
     <b>tag { ... }</b> is a node with children <b>&lt;tag&gt; ... &lt;/tag&gt;</b>
    </p>

    <p>
     <b>'utf8'</b> is standalone quoted content, inserted as is into the xml with &amp;&lt; et.al. protected.
    </p>

    <p>
    <b>tag = 'utf8'</b> is syntactic sugar for <b>tag { 'utf8' }</b> which is <b>&lt;tag&gt;utf8&lt;/tag&gt;</b>
    </p>

    <p>
     <b>tag = text</b> is syntactic sugar for <b>tag { 'text' }</b> which is <b>&lt;tag&gt;text&lt;/tag&gt;</b>
    </p>

    <p>
     <b>tag(id=123 class='x y') { ... }</b> is  <b>&lt;tag id="123" class="x y" &gt; ... &lt;/tag&gt;</b>
    </p>

    <p>
    Text that starts with <b>//</b> or <b>/*</b> is a comment, and will end with <b>eol</b> or <b>*/</b>.
    Quote such text to prevent it from being a comment. Comments are not permitted just
    before an <b>=</b> or a <b>{</b>, nor are they permitted inside parentheses.
    </p>

    <p>
    XMQ permits multiple root nodes in a single XMQ file. This is contrary to XML which only permits a single
    root node. An implicit root node will therefore be inserted when converting to XML. The root node tag will be the
    tag-safe version of the filename of the file containing the XMQ, or simply <b>root</b>.
    </p>

    <p>
    <b>whitespace</b> is a separator that is irrelevant except:
       <ol>
          <li>when separating <b>text</b> from the next <b>tag</b>.</li>
          <li>when separating <b>quoted content</b> from the following standalone <b>quoted content</b>.</li>
          <li>inside <b>quoted content</b></li>
       </ol>
    </p>

    <p>
       However, inside <b>quoted content</b>:
       <ol>
       <li>A leading or ending sequence of Whitespace_NewLine_Whitespace will always be trimmed.</li>
       <li>Incidental whitespace will always be trimmed, when there is at least one newline.</li>
       </ol>
    </p>

    <p>A newline is implicitly inserted between two standalone quoted contents.</p>

    <p>
    Three reasons for possible differences in the XML when converting XML->XMQ->XML.
    <ol>
    <li>CDATA will disappear when converting XML to XMQ. Thus documents containing CDATA,
    converted to XMQ and back TO XML will have lost their CDATA nodes. Still the content
    will be properly encoded using normal XML escapes, instead of CDATA.</li>
    <li>XML permits two types of quotation marks. XMQ defaults to " when generating XML,
    but might switch to ' for content containing ". Thus XMQ might not use the same quote character
    as the original XML.</li>
    <li>Leading/ending whitespace of content, is by default trimmed when loading XML for conversion into XMQ.
    To preserve whitespace add <b>-p</b></li>
    </ol>
    </p>

    <p>To avoid cluttering the examples below with xml declarations/html5 doctypes, <b>--nodec</b> is used.</p>

<div class="info"> Build a node using the syntactic sugar, tag=text.</div>
<div class="row">
<pre class="box">
<span style="color:#00aa00">value</span> = <span style="color:#aa0000">12.3</span>
</pre><pre class="spacing">⟷</pre><pre class="box">
&lt;value&gt;12.3&lt;/value&gt;
</pre></div>
<div class="info"> Whitespace is ignored.</div>
<div class="row">
<pre class="box">
value=12.3
</pre><pre class="spacing">↗</pre></div>
<div class="info"> Build a node with children, tag{ ... }.</div>
<div class="row">
<pre class="box">
<span style="color:#888800">// This is an example order.</span>
<span style="color:#000088">order</span> {
    <span style="color:#00aa00">date</span>  = <span style="color:#aa0000">2020-12-13</span>
    <span style="color:#00aa00">price</span> = <span style="color:#aa0000">424.5$</span>
    <span style="color:#00aa00">file</span>  = <span style="color:#aa0000">/imagefiles/1234.png</span>
}
</pre><pre class="spacing">⟷</pre><pre class="box">
&lt;!-- This is an example order. --&gt;
&lt;order&gt;
  &lt;date&gt;2020-12-13&lt;/date&gt;
  &lt;price&gt;424.5$&lt;/price&gt;
  &lt;file&gt;/imagefiles/1234.png&lt;/file&gt;
&lt;/order&gt;
</pre></div>
<div class="row">
<pre class="box">
// This is an example order.
order{date=2020-12-13 price=424.5$ file=/imagefiles/1234.png}
</pre><pre class="spacing">↗</pre></div>
<div class="info"> Build a node with the syntactic sugar, tag='utf8'. Remember that leading/ending ws-nl-ws is always trimmed from quotes.</div>
<div class="row">
<pre class="box">
<span style="color:#00aa00">alfa</span> = <span style="color:#aa0000">'Hello World!'</span>
</pre><pre class="spacing">⟷</pre><pre class="box">
&lt;alfa&gt;Hello World!&lt;/alfa&gt;
</pre></div>
<div class="row">
<pre class="box">
alfa =   '
      Hello World!
                    '</pre><pre class="spacing">↗</pre></div>
<div class="info"> Without the syntactic sugar, the same node can be created with standalone quoted content added as text to the parent node.</div>
<div class="row">
<pre class="box">
alfa {
    'Hello World!'
}
</pre><pre class="spacing">↗</pre></div>
<div class="info"> Build a node with leading/ending whitespace not trimmed! Note! xmq by default strips leading/ending whitespace when moving from XML to XMQ. Add opion -p to preserve whitespace, like this: "xmq -p foo.xml > foo.xmq".</div>
<div class="row">
<pre class="box">
</pre><pre class="spacing">⟷</pre><pre class="box">
&lt;alfa&gt;  Hello World!  &lt;/alfa&gt;
</pre></div>
