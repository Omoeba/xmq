\documentclass[10pt,a4paper]{article}
\usepackage{rail}
\usepackage{parskip}
\usepackage{changepage}
\usepackage{geometry}

\makeatletter
\newcommand*{\shifttext}[2]{%
  \settowidth{\@tempdima}{#2}%
  \raisebox{0pt}[0pt][0pt]{%
  \makebox[\@tempdima]{\hspace*{#1}#2}}%
}
\makeatother

\geometry{a4paper, layoutwidth=20cm, layoutheight=30cm}

\newcommand{\shiftleft}[2]{\makebox[0pt][r]{\makebox[#1][l]{#2}}}
\newcommand{\shiftright}[2]{\makebox[#1][r]{\makebox[0pt][l]{#2}}}

\railoptions{-t}
\relax

\pagestyle{empty}

\railalias{lbrace}{\{}
\railalias{rbrace}{\}}
\railalias{BSLASH}{\textbackslash}

\railterm{BSLASH}

\begin{document}

\textbf{Specification for XMQ by Fredrik Öhrström 2021 \texttt{oehrstroem@gmail.com}}

\vspace{5mm}

XMQ offers a more terse way of representing XML/HTML. Whitespace is an
ignored separator unless quoted. Therefore significant
whitespace will always be easy to spot in xmq since it requires
quoting.

\raisebox{45pt}{xmq:}
\begin{minipage}{15cm}
\begin{rail}
  doctype? ((node | QUOTE | COMMENT | pi) +)
\end{rail}
\end{minipage}

\raisebox{8pt}{node:}
\begin{minipage}{15cm}
\begin{rail}
  TEXT[tag] attributes? assignnode?
\end{rail}
\end{minipage}

\raisebox{-4pt}{TEXT:}
\begin{minipage}{15cm}
\begin{rail}
UTF8[excluding whitespace and ' = ( ) $\lbrace$ $\rbrace$]
\end{rail}
\end{minipage}

\raisebox{20pt}{assignnode:}
\begin{minipage}{15cm}
\begin{rail}
  ('=' ( TEXT[content] | QUOTE)) | lbrace xmq rbrace
\end{rail}
\end{minipage}

\raisebox{32pt}{QUOTE:}
\begin{minipage}{15cm}
\begin{rail}
  ("'" "'"
  |"'" UTF8[with no '] "'"
  | "'" "'" "'" UTF8[max 2 consec '] "'" "'" "'"
  | "'"[$\times$ n] UTF8[max n-1 consec '] "'"[$\times$ n])
\end{rail}
\end{minipage}

\raisebox{20pt}{attributes:}
\begin{minipage}{15cm}
\begin{rail}
'(' (TEXT[attribute] assignattr? +)  ')'
\end{rail}
\end{minipage}

\raisebox{32pt}{assignattr:}
\begin{minipage}{15cm}
\begin{rail}
  ('=' ( TEXT[content] | QUOTE )) | lbrace (QUOTE+) rbrace
\end{rail}
\end{minipage}

\raisebox{8pt}{pi:}
\begin{minipage}{15cm}
\begin{rail}
'?' TEXT[tag] assignattr?
\end{rail}
\end{minipage}

\raisebox{8pt}{COMMENT:}
\begin{minipage}{15cm}
\begin{rail}
  '//' UTF8 "0x0a"
  | '/*' UTF8 '*/'
\end{rail}
\end{minipage}

\textbf{XMQ rules.}

TEXT[tag] is text (ie UTF8 excluding whitespace and = ( ) \{ \})
but must also conform to the XML element name rules:
\begin{enumerate}
  \item{must start with a letter or underscore}
  \item{cannot start with the letters xml (or XML, or Xml, etc)}
  \item{can contain letters, digits, hyphens, underscores, and periods}
\end{enumerate}

After a quote has been found, the UTF8 is trimmed according to these rules:
\begin{enumerate}
\item{Any leading/ending whitespace newline whitespace is removed.}
\item{Incidental whitespace will always be trimmed, when there is at least one newline left.}
\end{enumerate}

Two consequtive quotes are joined with a newline.

\end{document}
